<Window x:Class="FullTextSearch.App.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="設定"
        Height="700" Width="600"
        WindowStartupLocation="CenterOwner"
        Style="{StaticResource MaterialDesignWindow}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- 対象フォルダ -->
                <materialDesign:Card Margin="0,0,0,16" Padding="16">
                    <StackPanel>
                        <TextBlock Text="検索対象フォルダ" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="0,0,0,8" />

                        <ListBox ItemsSource="{Binding TargetFolders}"
                                 SelectedItem="{Binding SelectedFolder}"
                                 Height="120"
                                 Margin="0,0,0,8" />

                        <StackPanel Orientation="Horizontal">
                            <Button Content="フォルダを追加"
                                    Command="{Binding AddFolderCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Margin="0,0,8,0" />
                            <Button Content="削除"
                                    Command="{Binding RemoveFolderCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    IsEnabled="{Binding SelectedFolder, Converter={StaticResource NullToBoolConverter}}" />
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 対象拡張子 -->
                <materialDesign:Card Margin="0,0,0,16" Padding="16">
                    <StackPanel>
                        <TextBlock Text="対象ファイル拡張子" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="0,0,0,8" />

                        <ItemsControl ItemsSource="{Binding TargetExtensions}"
                                      Margin="0,0,0,8">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <materialDesign:Chip Content="{Binding}"
                                                         IsDeletable="True"
                                                         DeleteCommand="{Binding DataContext.RemoveExtensionCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                         DeleteCommandParameter="{Binding}"
                                                         Margin="0,0,4,4" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Text="{Binding NewExtension, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="例: .txt"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     Margin="0,0,8,0" />
                            <Button Grid.Column="1"
                                    Content="追加"
                                    Command="{Binding AddExtensionCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}" />
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- その他の設定 -->
                <materialDesign:Card Margin="0,0,0,16" Padding="16">
                    <StackPanel>
                        <TextBlock Text="その他の設定" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="0,0,0,16" />

                        <!-- インデックス保存先 -->
                        <TextBlock Text="インデックス保存先"
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   Margin="0,0,0,4" />
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Text="{Binding IndexPath}"
                                     IsReadOnly="True"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     Margin="0,0,8,0" />
                            <Button Grid.Column="1"
                                    Content="参照"
                                    Command="{Binding BrowseIndexPathCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}" />
                        </Grid>

                        <!-- プレビュー遅延 -->
                        <TextBlock Text="プレビュー切り替え遅延 (ms)"
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   Margin="0,0,0,4" />
                        <Slider Value="{Binding PreviewDelayMs}"
                                Minimum="50" Maximum="500"
                                TickFrequency="50"
                                IsSnapToTickEnabled="True"
                                Style="{StaticResource MaterialDesignDiscreteSlider}"
                                Margin="0,0,0,16" />

                        <!-- 検索履歴 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="検索履歴の最大保存件数"
                                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                                           Margin="0,0,0,4" />
                                <TextBox Text="{Binding MaxSearchHistory}"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Width="100"
                                         HorizontalAlignment="Left" />
                            </StackPanel>

                            <Button Grid.Column="1"
                                    Content="検索履歴をクリア"
                                    Command="{Binding ClearSearchHistoryCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    VerticalAlignment="Bottom" />
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>
        </ScrollViewer>

        <!-- ボタン -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="リセット"
                    Command="{Binding ResetCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Margin="0,0,8,0" />
            <Button Content="保存"
                    Command="{Binding SaveCommand}"
                    Style="{StaticResource MaterialDesignFlatMidBgButton}"
                    IsEnabled="{Binding HasChanges}" />
        </StackPanel>
    </Grid>
</Window>

