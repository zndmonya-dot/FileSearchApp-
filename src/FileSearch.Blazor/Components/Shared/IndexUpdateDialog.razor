@namespace FileSearch.Blazor.Components.Shared
@if (Visible)
{
    <div class="modal-backdrop" @onclick="OnCancel">
        <div class="index-update-dialog" @onclick:stopPropagation="true">
            <div class="index-update-header">
                <svg viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"><path d="M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z"/></svg>
                <h2 class="index-update-title">インデックスの更新</h2>
                <button type="button" class="index-update-close" @onclick="OnCancel" aria-label="閉じる">
                    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"/></svg>
                </button>
            </div>
            <div class="index-update-body">
                <p class="index-update-desc">更新方法を選んでください。</p>
                <div class="index-update-options">
                    <button type="button" class="index-update-option @(!FullRebuildSelected ? "selected" : "")" @onclick="() => SelectMode(false)">
                        <span class="index-update-option-title">差分更新</span>
                        <span class="index-update-option-desc">追加・変更・削除されたファイルのみ反映。速く完了します。</span>
                    </button>
                    <button type="button" class="index-update-option @(FullRebuildSelected ? "selected" : "")" @onclick="() => SelectMode(true)">
                        <span class="index-update-option-title">全体を再構築</span>
                        <span class="index-update-option-desc">対象フォルダを全件スキャンし直します。時間がかかります。</span>
                    </button>
                </div>
            </div>
            <div class="index-update-footer">
                <button type="button" class="action-btn" @onclick="OnCancel">キャンセル</button>
                <button type="button" class="action-btn primary" @onclick="OnConfirm">実行</button>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public bool FullRebuildSelected { get; set; }
    [Parameter] public EventCallback<bool> FullRebuildSelectedChanged { get; set; }
    [Parameter] public EventCallback OnConfirm { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }

    private async Task SelectMode(bool fullRebuild)
    {
        await FullRebuildSelectedChanged.InvokeAsync(fullRebuild);
    }
}
