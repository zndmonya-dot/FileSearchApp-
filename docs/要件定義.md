# 要件定義書

## 1. はじめに

### 1.1 目的

本ドキュメントは、社内ファイルサーバ向け全文検索システム（以下「本システム」）の要件を定義する。

### 1.2 スコープ

- 対象: 社内のファイルサーバ（UNC パス）上に格納された文書・ファイルの全文検索
- 対象外: メール、クラウドストレージ、Web 上のコンテンツなどは本システムのスコープ外とする

---

## 2. システム概要

### 2.1 背景・目的

社内のファイルサーバには大量の文書（Word、Excel、PDF、テキストなど）が格納されている。利用者がキーワードで検索し、目的のファイルを素早く見つけられるようにすることを目的とする。

### 2.2 システムの位置づけ

- Windows 向けのデスクトップアプリケーション（Blazor Hybrid / MAUI）
- 利用者は社内の PC に本アプリをインストールし、自ら設定した「検索対象フォルダ」に対して全文検索を行う
- 検索エンジンとして Lucene.NET を、日本語形態素解析に Sudachi を使用する

---

## 3. 機能要件

### 3.1 設定機能

| No. | 機能 | 説明 |
|-----|------|------|
| REQ-1.1 | 検索対象フォルダの設定 | 検索対象とするフォルダ（UNC パス含む）を複数登録・保存できること |
| REQ-1.2 | 対象拡張子の設定 | インデックス対象とするファイル拡張子を指定できること（未指定時は対応する全拡張子を使用） |
| REQ-1.3 | インデックス保存先の設定 | インデックスを保存するローカルフォルダを指定できること |
| REQ-1.4 | プレビュー遅延の設定 | プレビュー切り替え遅延はモデルに定義されているが、現状の設定画面では項目を表示していない（将来対応可能） |
| REQ-1.5 | 自動再構築間隔の設定 | インデックスの定期再構築間隔（分）を設定できること（0 で無効） |
| REQ-1.6 | テーマの設定 | 表示テーマ（Dark / Light / System）を選択できること |

### 3.2 インデックス機能

| No. | 機能 | 説明 |
|-----|------|------|
| REQ-2.1 | インデックス再構築 | 指定フォルダ群についてインデックスを全削除のうえ全件再作成できること |
| REQ-2.2 | インデックス差分更新 | 追加・更新・削除されたファイルのみを反映する差分更新ができること（大量ファイルで高速） |
| REQ-2.3 | 進捗表示 | インデックス作成・更新時に処理済み数／総数／現在ファイル／エラー数を表示すること |
| REQ-2.4 | 自動更新 | 設定した間隔でインデックスを自動再構築できること（オプション） |

### 3.3 検索機能

| No. | 機能 | 説明 |
|-----|------|------|
| REQ-3.1 | キーワード全文検索 | インデックス済みテキストに対してキーワードで全文検索できること |
| REQ-3.2 | 日本語形態素解析 | 日本語を形態素単位で分割し、適切に検索できること（Sudachi モード C） |
| REQ-3.3 | 検索結果一覧表示 | ヒットしたファイルを一覧表示し、ファイル名・パス・更新日・種類・スコア等を表示すること |
| REQ-3.4 | マッチ箇所の表示 | 検索キーワードがヒットした箇所を前後の文脈付きで抜粋し、ハイライト表示すること |
| REQ-3.5 | 検索オプション | API 上は複数指定可能。現状 UI からは最大件数のみ指定（内部で 100,000 件）。ファイル種類・日付・フォルダフィルターは UI 未対応 |

### 3.4 プレビュー機能

| No. | 機能 | 説明 |
|-----|------|------|
| REQ-4.1 | テキストプレビュー | テキスト・ソースコードファイルをその内容でプレビュー表示すること |
| REQ-4.2 | Office/PDF プレビュー | Word / Excel / PowerPoint / PDF をテキスト抽出した行表示でプレビューすること（表形式・ネイティブプレビューは行わない） |
| REQ-4.3 | （REQ-4.2 に統合） | — |
| REQ-4.4 | プレビュー内ハイライト | 検索クエリに合わせてプレビュー内のマッチ箇所をハイライトすること |
| REQ-4.5 | プレビュー切り替え | 検索結果で選択を変更した際、300ms デバウンス後にプレビューを切り替えること（連続クリック時の無駄な抽出を抑える） |

### 3.5 操作・キーボード

| No. | 機能 | 説明 |
|-----|------|------|
| REQ-5.1 | 検索結果の選択 | 検索結果一覧の選択はマウスクリックで行う。上下キーでの選択移動は未実装 |
| REQ-5.2 | Enter でファイルを開く | 選択中のファイルを関連アプリで開くこと |
| REQ-5.3 | Ctrl+Enter でフォルダを開く | 選択中のファイルの親フォルダを開くこと |
| REQ-5.4 | Ctrl+C でパスコピー | 選択中のファイルのフルパスをクリップボードにコピーすること |
| REQ-5.5 | Ctrl+F で検索フォーカス | 検索ボックスにフォーカスすること |
| REQ-5.6 | Esc で検索クリア | 検索クエリをクリアすること |

### 3.6 対応ファイル形式

| 種別 | 拡張子 | 備考 |
|------|--------|------|
| Office | .docx, .xlsx, .pptx | DocumentFormat.OpenXml でテキスト抽出 |
| PDF | .pdf | PdfPig でテキスト抽出 |
| テキスト・コード | .txt, .csv, .log, .md, .cs, .js, .ts, .py, .java, .html 等 | テキストとして抽出（詳細は静的定義一覧参照） |

---

## 4. 非機能要件

### 4.1 動作環境

| 項目 | 要件 |
|------|------|
| OS | Windows 10 / 11 専用 |
| ランタイム | .NET 8 SDK |
| 形態素解析 | Python 3、SudachiPy および辞書（`pip install sudachipy sudachidict_core`） |
| プレビュー | 不要（全形式ともテキスト抽出で表示。Office はファイルを開く際に利用可能） |

### 4.2 パフォーマンス

- 初回検索の遅延を軽減するため、インデックス読み込み・アナライザのウォームアップを行う
- 大量ファイルがある場合、再構築ではなく差分更新により短時間でインデックスを更新できるようにする

### 4.3 互換性・運用

- 形態素解析（アナライザ）を変更した場合、既存のインデックスは互換性がなくなる。その場合は「インデックスを再構築」を実行すること

### 4.4 セキュリティ・配布

- 社内配布時は MSIX パッケージと証明書をセットで配布する手順に従う（別途「社内配布手順」参照）
- 証明書不要のスタンドアロン exe（ZIP）配布もビルドスクリプトで生成可能とする

---

## 5. 制約・前提

- 本システムは Windows 専用であり、他 OS は対象としない
- 検索対象は「利用者が設定したフォルダ」に限定され、端末内の全ドライブを自動で対象にはしない
- ファイルサーバへのアクセスは、実行環境のネットワーク・権限に依存する

---

## 6. 用語・略語

| 用語 | 説明 |
|------|------|
| インデックス | 検索用にファイルから抽出したテキストを格納したデータ。Lucene により管理される |
| 形態素解析 | 文を意味の最小単位（形態素）に分割すること。日本語検索の精度向上に利用する |
| Sudachi | 日本語形態素解析器。本システムでは SudachiPy（Python）をモード C で使用する |
| Lucene | Apache Lucene。全文検索エンジン。本システムでは Lucene.NET を使用する |
| UNC パス | 例: `\\server\share\folder` のようなネットワークパス |

---

## 7. 参照ドキュメント

- [README.md](../README.md) - 概要・セットアップ・使い方
- [社内配布手順.md](社内配布手順.md) - MSIX 配布・インストール手順
- [静的定義一覧.md](静的定義一覧.md) - 拡張子・定数一覧
