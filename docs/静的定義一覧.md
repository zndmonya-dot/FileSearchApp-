# 静的定義（static / const）一覧

コードベース内の静的定義を分類し、動的にすべき候補と対応状況をまとめました。

---

## 1. 拡張子・ファイル種別の静的定義

### 1.1 抽出器の対応拡張子（現状は静的のまま）

| 場所 | 内容 | 備考 |
|------|------|------|
| **TextFileExtractor.cs** | `SupportedExtensionSet`（.txt, .csv, .log, .md, .cs, ...） | 抽出器が対応する拡張子を静的定義。新規拡張子はコード変更が必要。動化は別タスク（低優先度）。 |
| **OfficeExtractor.cs** | `SupportedExtensionSet`（.docx, .xlsx, .pptx） | 同上。 |
| **PdfExtractor.cs** | `SupportedExtensionSet`（.pdf） | 同上。 |

### 1.2 プレビュー種別（対応済み：抽出器から導出）

プレビュー種別（テキスト / Office / PDF）は **抽出器から導出** 済みです。`PreviewService` および `LuceneIndexService` は `TextExtractorFactory.GetExtractor(extension)` で取得した抽出器の `PreviewCategory` を使用しており、拡張子の二重管理はありません。

（過去のドキュメントにあった `PreviewHelper` の `OfficeExtensions` / `TextExtensions` / `ImageExtensions` / `GetImageMimeType` は、現在のコードベースには存在しません。）

### 1.3 シンタックスハイライト用（動的化済み）

| 場所 | 内容 | 備考 |
|------|------|------|
| **PreviewHelper.cs** | `LanguageMap`（.cs→csharp, .js→javascript, ...） | 組み込みの既定マップ。**設定の ExtensionLanguageMap で上書き・追加可能**（動的化済み）。 |
| **PreviewHelper.cs** | `CodeExtensions` | LanguageMap のキーから生成。言語解決時に設定マップと組み込みマップをマージして判定。 |

---

## 2. パス・設定の静的定義

| 場所 | 内容 | 備考 |
|------|------|------|
| **FullTextSearch.Core / DefaultPaths.cs** | `IndexPath`（LocalApplicationData/FullTextSearch/Index） | **デフォルトパスはここに一元化済み**。AppSettings.IndexPath のデフォルト値および LuceneSearchService のフォールバックはいずれもこれを参照。 |
| **AppSettingsService.cs** | `SettingsPath`（LocalApplicationData/FullTextSearch/settings.json） | 設定ファイルのパス。環境に依存するが定数として妥当。 |
| **AppSettingsService.cs** | `JsonOptions` | シリアライズオプション。変更頻度低い。 |

---

## 3. Lucene・検索まわりの定数（変更すると互換性に影響）

| 場所 | 内容 | 備考 |
|------|------|------|
| **LuceneIndexService.cs** | `FieldFilePath`, `FieldFileName`, `FieldContent` など | フィールド名。変更すると既存インデックスと互換が崩れるため静的でよい。 |
| **LuceneIndexService.cs** | `AppLuceneVersion`, `ParallelExtractCount` | バージョン・並列数。 |
| **LuceneSearchService.cs** | `AppLuceneVersion`, `HighlightFragmentSize`, `MaxHighlights`, `FilenameBoost`, `MaxQueryTerms`, `MaxQueryClauses` | 検索・ハイライトの定数。 |
| **SudachiTokenizer.cs** | `MaxTermUtf8Bytes` (32765) | Lucene のトークン長制限。 |
| **SudachiAnalyzer.cs** | `MatchVersion` | Lucene バージョン。 |

これらは仕様・互換性のための定数として静的で問題なし。

---

## 4. プレビュー・UI まわりの定数

| 場所 | 内容 | 備考 |
|------|------|------|
| **App.xaml.cs** | `CreateWindow` 内で `Window.Title = "全文検索システム"` | ウィンドウタイトルバー・Alt+Tab に表示。MAUI Windows では ContentPage.Title は反映されないためここで設定。 |
| **FileSearch.Blazor.csproj** | `ApplicationTitle`（全文検索システム） | スプラッシュ画面・パッケージ表示等に使用。ウィンドウタイトルは App.CreateWindow で設定。 |
| **PreviewService.cs** | `PreviewMaxChars` (50_000), `PreviewMaxLinesForHighlight` (500) | プレビュー上限。必要なら設定化の余地あり。 |
| **Home.razor.cs** | `ProgressReportInterval`, `ProgressReportThrottleMs` | 進捗表示の間隔。 |
| **Home.razor.cs** | `MsgNoTargetFolders`, `MsgUpdateFailed`, `MsgRebuildFailed` | メッセージ文字列。多言語化するならリソース化の余地あり。 |

---

## 5. ロック・キャッシュ用（問題なし）

| 場所 | 内容 | 備考 |
|------|------|------|
| **SudachiTokenizer.cs** | `SharedProcessLock`, `ScriptPathLock`, `PythonCacheLock` | マルチスレッド用ロック。静的でよい。 |
| **SudachiTokenizer.cs** | `StreamDelim` ("---SUDACHI_DOC_END---") | Python とのプロトコル。変更すると互換が崩れる。 |

---

## 6. まとめ：動的化の対応状況

| 優先度 | 内容 | 状況 |
|--------|------|------|
| **高** | プレビュー種別を抽出器から導出 | **対応済み**。GetExtractor / PreviewCategory で導出。 |
| **中** | デフォルトインデックスパスの一元化 | **対応済み**。DefaultPaths.IndexPath に統一。 |
| **高** | LanguageMap / CodeExtensions の設定化 | **対応済み**。AppSettings.ExtensionLanguageMap で拡張子→言語を追加・上書き可能。 |
| **低** | 抽出器の SupportedExtensionSet の動的化 | **別タスク**。設定やプラグインで拡張子を追加する設計は変更が大きいため未対応。 |
