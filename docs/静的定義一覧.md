# 静的定義（static / const）一覧

コードベース内の静的定義を分類し、動的にすべき候補をまとめました。

---

## 1. 拡張子・ファイル種別の静的定義（動化・二重管理の要検討）

| 場所 | 内容 | 問題点 |
|------|------|--------|
| **TextFileExtractor.cs** | `SupportedExtensionSet`（.txt, .csv, .log, .md, .cs, ...） | 抽出器が対応する拡張子を静的定義。新規拡張子はコード変更が必要。 |
| **OfficeExtractor.cs** | `SupportedExtensionSet`（.docx, .xlsx, .pptx） | 同上。 |
| **PdfExtractor.cs** | `SupportedExtensionSet`（.pdf） | 同上。 |
| **PreviewHelper.cs** | `OfficeExtensions`（.doc, .docx, .xls, .xlsx, .ppt, .pptx, .pdf） | プレビュー種別判定用。Extractor の対応拡張子と二重管理。Extractor に追加してもここに追加し忘れるとプレビュー種別がずれる。 |
| **PreviewHelper.cs** | `ImageExtensions`（.png, .jpg, .jpeg, .gif, .bmp, .webp, .ico, .svg） | 画像プレビュー用。画像は抽出器なしなので単独管理だが、拡張子追加時はここも更新が必要。 |
| **PreviewHelper.cs** | `TextExtensions`（.txt, .csv, .log, .md, ...） | テキストプレビュー用。**TextFileExtractor.SupportedExtensionSet と重複**。抽出器に拡張子を追加してもここに追加し忘れると「テキストとしてプレビュー」されない可能性。 |
| **PreviewHelper.cs** | `LanguageMap`（.cs→csharp, .js→javascript, ...） | シンタックスハイライト用言語マップ。拡張子追加時にここにも追加し忘れると `plaintext` になる。 |
| **PreviewHelper.cs** | `CodeExtensions` | LanguageMap のキーから生成。LanguageMap と一体。 |
| **PreviewHelper.cs** | `GetImageMimeType` の switch | 画像 MIME タイプ。画像拡張子追加時にここも更新が必要。 |

**推奨の方向性**

- **抽出器の SupportedExtensionSet**: 現状は静的のまま。動化する場合は設定ファイルや「拡張子→抽出器」の登録など設計変更が必要（別タスク）。
- **PreviewHelper と Extractor の二重管理**: プレビュー種別（画像 / Office / テキスト / コード）を **抽出器の情報から導出**するようにすると、拡張子を一箇所（Extractor）だけ管理できる。例: 「テキストとしてプレビュー」＝ TextFileExtractor が対応する拡張子、「Office」＝ OfficeExtractor + PdfExtractor が対応する拡張子、など。LanguageMap だけは「コード用言語」なので、Extractor とは別に持つか、設定で拡張可能にするか検討。

---

## 2. パス・設定の静的定義

| 場所 | 内容 | 備考 |
|------|------|------|
| **AppSettingsService.cs** | `SettingsPath`（LocalApplicationData/FullTextSearch/settings.json） | 設定ファイルのパス。環境に依存するが定数として妥当。 |
| **AppSettingsService.cs** | `JsonOptions` | シリアライズオプション。変更頻度低い。 |
| **LuceneSearchService.cs** | `DefaultIndexPath`（LocalApplicationData/FullTextSearch/Index） | **AppSettings.IndexPath のデフォルトと同一パス**。GetIndexPath() で「設定が空のとき」のフォールバックに使用。二重定義なので、AppSettings のデフォルトに寄せるか、定数1つにまとめるとよい。 |
| **AppSettings.cs** | `IndexPath` のデフォルト値 | Path.Combine(LocalApplicationData, "FullTextSearch", "Index")。上記 DefaultIndexPath と重複。 |

---

## 3. Lucene・検索まわりの定数（変更すると互換性に影響）

| 場所 | 内容 | 備考 |
|------|------|------|
| **LuceneIndexService.cs** | `FieldFilePath`, `FieldFileName`, `FieldContent` など | フィールド名。変更すると既存インデックスと互換が崩れるため静的でよい。 |
| **LuceneIndexService.cs** | `AppLuceneVersion`, `ParallelExtractCount` | バージョン・並列数。 |
| **LuceneSearchService.cs** | `AppLuceneVersion`, `HighlightFragmentSize`, `MaxHighlights`, `FilenameBoost`, `MaxQueryTerms`, `MaxQueryClauses` | 検索・ハイライトの定数。 |
| **SudachiTokenizer.cs** | `MaxTermUtf8Bytes` (32765) | Lucene のトークン長制限。 |
| **SudachiAnalyzer.cs** | `MatchVersion` | Lucene バージョン。 |

これらは仕様・互換性のための定数として静的で問題なし。

---

## 4. プレビュー・UI まわりの定数

| 場所 | 内容 | 備考 |
|------|------|------|
| **PreviewService.cs** | `PreviewMaxChars` (50_000), `PreviewMaxLinesForHighlight` (500) | プレビュー上限。必要なら設定化の余地あり。 |
| **Home.razor.cs** | `ProgressReportInterval`, `ProgressReportThrottleMs` | 進捗表示の間隔。 |
| **Home.razor.cs** | `MsgNoTargetFolders`, `MsgUpdateFailed`, `MsgRebuildFailed` | メッセージ文字列。多言語化するならリソース化の余地あり。 |

---

## 5. ロック・キャッシュ用（問題なし）

| 場所 | 内容 | 備考 |
|------|------|------|
| **SudachiTokenizer.cs** | `SharedProcessLock`, `ScriptPathLock`, `PythonCacheLock` | マルチスレッド用ロック。静的でよい。 |
| **SudachiTokenizer.cs** | `StreamDelim` ("---SUDACHI_DOC_END---") | Python とのプロトコル。変更すると互換が崩れる。 |

---

## 6. まとめ：動的にすべき候補（優先度）

1. **高**: **PreviewHelper と Extractor の二重管理**  
   テキスト/Office/画像のプレビュー種別を、可能な範囲で **抽出器の SupportedExtensions / GetAllSupportedExtensions() から導出**する。拡張子を一箇所で管理し、追加し忘れを防ぐ。

2. **中**: **DefaultIndexPath と AppSettings.IndexPath の重複**  
   デフォルトインデックスパスを1箇所（例: AppSettings のデフォルトのみ）にし、LuceneSearchService は「設定が空なら AppSettings のデフォルト値を使う」ようにする（または共通定数を Core に1つ持つ）。

3. **低**: 抽出器の SupportedExtensionSet を設定やプラグインで動的にする（設計変更が大きいため別タスク）。

必要なら、上記「高」のプレビュー種別の動的化の具体的な変更案（どのクラスをどう変えるか）もまとめます。
