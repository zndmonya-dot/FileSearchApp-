# 静的定義（static / const）一覧

コードベース内の静的定義を分類し、動的にすべき候補と対応状況をまとめました。

---

## 1. 拡張子・ファイル種別の静的定義

### 1.1 抽出器の対応拡張子（現状は静的のまま）

| 場所 | 内容 | 備考 |
|------|------|------|
| **TextFileExtractor.cs** | `SupportedExtensionSet`（.txt, .csv, .log, .md, .cs, ...） | 抽出器が対応する拡張子を静的定義。新規拡張子はコード変更が必要。動化は別タスク（低優先度）。 |
| **OfficeExtractor.cs** | `SupportedExtensionSet`（.docx, .xlsx, .pptx） | 同上。 |
| **PdfExtractor.cs** | `SupportedExtensionSet`（.pdf） | 同上。 |

### 1.2 プレビュー種別（対応済み：抽出器から導出）

プレビュー表示は **すべてテキスト（行リスト）** です。OfficeExtractor も PreviewCategory=Text とし、.docx/.xlsx/.pptx はテキスト抽出の行表示のみ。表形式・HTML プレビューは行いません。抽出器の `PreviewCategory` は GetExtractor で参照されるが、現状は表示経路の分岐には使わず、拡張子の二重管理はありません。

（過去のドキュメントにあった `PreviewHelper` の `OfficeExtensions` / `TextExtensions` / `ImageExtensions` / `GetImageMimeType` は、現在のコードベースには存在しません。）

### 1.3 シンタックスハイライト用（現在は未使用）

かつては `PreviewHelper.LanguageMap` と `AppSettings.ExtensionLanguageMap` を用いた **シンタックスハイライト用の拡張子→言語マップ** を持っていましたが、  
プレビュー処理から Highlight.js ベースのシンタックスハイライト機能を削除したため、これらの定義は現在のコードベースからも削除されています。

---

## 2. パス・設定の静的定義

| 場所 | 内容 | 備考 |
|------|------|------|
| **FullTextSearch.Core / DefaultPaths.cs** | `IndexPath`（LocalApplicationData/FullTextSearch/Index） | **デフォルトパスはここに一元化済み**。AppSettings.IndexPath のデフォルト値および LuceneSearchService のフォールバックはいずれもこれを参照。 |
| **AppSettingsService.cs** | `SettingsPath`（LocalApplicationData/FullTextSearch/settings.json） | 設定ファイルのパス。環境に依存するが定数として妥当。 |
| **AppSettingsService.cs** | `JsonOptions` | シリアライズオプション。変更頻度低い。 |

---

## 3. Lucene・検索まわりの定数（変更すると互換性に影響）

| 場所 | シンボル | 値 | 備考 |
|------|----------|-----|------|
| **LuceneIndexService.cs** | FieldFilePath | "filepath" | インデックスフィールド名。変更すると既存インデックスと互換が崩れる。 |
| **LuceneIndexService.cs** | FieldFileName | "filename" | 同上。 |
| **LuceneIndexService.cs** | FieldFolderPath | "folderpath" | 同上。 |
| **LuceneIndexService.cs** | FieldContent | "content" | 同上。 |
| **LuceneIndexService.cs** | FieldFileSize, FieldLastModified, FieldFileType, FieldIndexedAt | "filesize", "lastmodified", "filetype", "indexedat" | 同上。 |
| **LuceneIndexService.cs** | AppLuceneVersion | LUCENE_48 | Lucene バージョン。 |
| **LuceneIndexService.cs** | ParallelExtractCount | 48 | 並列抽出数。 |
| **LuceneSearchService.cs** | AppLuceneVersion | LUCENE_48 | 同上。 |
| **LuceneSearchService.cs** | HighlightFragmentSize | 100 | ハイライト抜粋のフラグメント長。 |
| **LuceneSearchService.cs** | MaxHighlights | 5 | 最大ハイライト数。 |
| **LuceneSearchService.cs** | ReaderOpenRetryMs | 150 | リーダーオープンリトライ間隔（ミリ秒）。 |
| **LuceneSearchService.cs** | FilenameBoost | 2.5f | ファイル名マッチのブースト係数。 |
| **LuceneSearchService.cs** | MaxQueryTerms | 64 | クエリ最大トークン数。 |
| **LuceneSearchService.cs** | MaxQueryClauses | 256 | クエリ最大句数。 |
| **ContentLimits.cs** | LuceneMaxTermUtf8Bytes | 32765 | Lucene の 1 トークンあたり最大 UTF-8 バイト数。 |
| **ContentLimits.cs** | IndexMaxContentChars | 500_000 | 1 ドキュメントあたりインデックス格納最大文字数。 |
| **ContentLimits.cs** | IndexMaxFileBytesForExtract | 50MB | このサイズを超えるファイルは本文抽出しない。 |
| **ContentLimits.cs** | ExtractMaxChars | 500_000 | 抽出器が返す最大文字数。 |
| **ContentLimits.cs** | PreviewMaxFileBytes | 10MB | プレビューを試みる最大ファイルサイズ。 |
| **ContentLimits.cs** | MaxTextFileBytesToRead | 10MB | テキストファイルとして読み込む最大サイズ。 |
| **SudachiTokenizer.cs** | MaxTermUtf8Bytes | 32765 | Lucene トークン長制限（同上）。 |
| **SudachiTokenizer.cs** | MaxInputCharsForTokenize | 500_000 | トークナイズ入力の最大文字数。 |
| **SudachiTokenizer.cs** | MaxBatchDocuments | 40 | バッチあたり最大ドキュメント数。 |
| **SudachiTokenizer.cs** | MaxCharsPerContentInBatch | 80_000 | バッチ内 1 コンテンツあたり最大文字数。 |
| **SudachiTokenizer.cs** | StreamDelim | "---SUDACHI_DOC_END---" | Python とのプロトコル区切り。 |
| **SudachiAnalyzer.cs** | MatchVersion | LUCENE_48 | Lucene バージョン。 |

これらは仕様・互換性のための定数として静的で問題なし。

---

## 4. プレビュー・UI まわりの定数

| 場所 | シンボル | 値 | 備考 |
|------|----------|-----|------|
| **App.xaml.cs** | Window.Title | "全文検索システム" | ウィンドウタイトルバー・Alt+Tab。MAUI Windows では ContentPage.Title は反映されないためここで設定。 |
| **FileSearch.Blazor.csproj** | ApplicationTitle | 全文検索システム | スプラッシュ画面・パッケージ表示等。ウィンドウタイトルは App.CreateWindow で設定。 |
| **ContentLimits.cs** | PreviewMaxChars | 50_000 | プレビュー表示の最大文字数。Core で一元定義。 |
| **ContentLimits.cs** | PreviewMaxLinesForHighlight | 50_000 | ハイライトをかける最大行数（Core）。 |
| **ContentLimits.cs** | PreviewLineHeightPx | 20 | プレビュー行の高さ（px）。Virtualize の ItemSize と揃える。 |
| **PreviewService.cs** | PreviewMaxChars | 50_000 | プレビュー上限（抽出テキストを切り詰める上限）。 |
| **Home.razor.cs** | PreviewDebounceMs | 200 | ファイル選択変更後、プレビュー読み込みを発行するまでのデバウンス（ミリ秒）。 |
| **Home.razor.cs** | ProgressReportInterval | 500 | 進捗表示の報告間隔。 |
| **Home.razor.cs** | ProgressReportThrottleMs | 250 | 進捗表示のスロットル（ミリ秒）。 |
| **Home.razor.cs** | MsgNoTargetFolders, MsgUpdateFailed, MsgRebuildFailed | （本文「7. エラー・メッセージ」参照） | インデックス操作時のユーザー向けメッセージ。 |
**index.html** | scrollToNextHighlight / scrollToPrevHighlight | （JavaScript関数） | ハイライトナビゲーション。**行単位で移動**（WinMerge風）。同じ行内の複数のmark要素をグループ化し、行インデックスで移動する。 |

※ プレビュー遅延（デバウンス）は上記 Home.razor.cs の `PreviewDebounceMs` のみ。AppSettings の `PreviewDelayMs` は削除済み。
※ ハイライトナビゲーションは行単位で動作する。同じ行に複数のmark要素があっても、その行は1つの単位として扱われ、次へ/前へで行単位で移動する。

---

## 5. ロック・キャッシュ用（問題なし）

| 場所 | 内容 | 備考 |
|------|------|------|
| **SudachiTokenizer.cs** | `SharedProcessLock`, `ScriptPathLock`, `PythonCacheLock` | マルチスレッド用ロック。静的でよい。 |
| **SudachiTokenizer.cs** | `StreamDelim` ("---SUDACHI_DOC_END---") | Python とのプロトコル。変更すると互換が崩れる。 |

---

## 6. エラー・メッセージ定義

ユーザーに表示される文言およびバリデーション・例外メッセージの一覧。多言語化や文言変更時の参照用。

### 6.1 インデックス・検索（Home.razor.cs）

| シンボル / 出現箇所 | 文言 | 用途 |
|---------------------|------|------|
| MsgNoTargetFolders | 対象フォルダを設定してください。 | 対象フォルダ未設定でインデックス操作したとき |
| MsgUpdateFailed | 差分更新に失敗しました。 | 差分更新の例外時（続けて ex.Message を付与する場合あり） |
| MsgRebuildFailed | インデックス構築に失敗しました。 | 再構築の例外時 |
| （ハードコード） | 検索に失敗しました。 | 検索実行の catch 時 |

### 6.2 プレビュー（PreviewService.cs, Home.razor.cs）

| 出現箇所 | 文言 | 用途 |
|----------|------|------|
| PreviewService | ファイルパスが指定されていません | プレビュー呼び出しでパスが空のとき |
| PreviewService | [キャンセル] | プレビュー処理のキャンセル時 |
| Home.razor.cs | [エラー] {ex.Message} | プレビュー取得で例外が発生したとき（1 行表示） |

### 6.3 設定画面・バリデーション（Home.razor.cs → SettingsEditState）

| プロパティ | 文言 | 用途 |
|------------|------|------|
| FolderMessage | フォルダパスを入力してください | フォルダ追加で空のとき |
| FolderMessage | フォルダが見つかりません。パスを確認してください。 | パスが存在しないとき |
| FolderMessage | 既に追加されています | 同一フォルダを追加しようとしたとき |
| ExtensionMessage | 既に追加されています | 同一拡張子を追加しようとしたとき |

### 6.4 例外・ログ（仕様把握用、ユーザーにそのままは出さない）

| 場所 | 内容 | 備考 |
|------|------|------|
| LuceneIndexService.cs | InvalidOperationException("IndexService has not been initialized. Call InitializeAsync first.") | 未初期化で検索・更新したとき |
| OfficeExtractor / PdfExtractor / TextFileExtractor | FileNotFoundException("File not found", filePath) | ファイルが存在しないとき |
| TextFileExtractor.cs | InvalidOperationException("File is too large: {size} bytes") | テキストファイルが MaxTextFileBytesToRead を超えたとき |

---

## 7. まとめ：動的化の対応状況

| 優先度 | 内容 | 状況 |
|--------|------|------|
| **高** | プレビュー種別を抽出器から導出 | **対応済み**。GetExtractor / PreviewCategory で導出。 |
| **中** | デフォルトインデックスパスの一元化 | **対応済み**。DefaultPaths.IndexPath に統一。 |
| **高** | LanguageMap / CodeExtensions の設定化 | **削除済み**。シンタックスハイライト機能廃止に伴い、拡張子→言語マップは現在使用していない。 |
| **低** | 抽出器の SupportedExtensionSet の動的化 | **別タスク**。設定やプラグインで拡張子を追加する設計は変更が大きいため未対応。 |
